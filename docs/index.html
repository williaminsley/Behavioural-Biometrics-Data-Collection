<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"
  />
  <title>Behaviour Game</title>
  <link rel="stylesheet" href="styles.css" />
</head>

<body>
  <main class="container">

    <!-- ================= CONSENT ================= -->
    <section id="screen-consent" class="screen active">
      <h1>60s Typing + 60s Tapping</h1>
      <p class="muted">
        This study collects anonymous interaction timing data from typing and tapping tasks for academic research into behavioural biometrics (continuous authentication).
        <br><br>
        <strong>What we collect:</strong> timestamps and timing features from key presses and taps, plus the context options you select (time of day, fatigue, input device, vibration, alcohol).
        <br>
        <strong>What we do NOT collect:</strong> no names, emails, IP addresses, or any personal identifiers. No raw typed text is stored.
        <br><br>
        Participation is voluntary. You can stop at any time by closing the page.
        If you wish to withdraw your data, contact: <strong>ppywi1@nottingham.ac.uk</strong> and include the Participant ID shown on the Results screen.
        <br>
        <strong>18+ only.</strong>
        <br><br>
        Do not play while driving.
      </p>


      <div class="check">
        <input id="consentCheckbox" type="checkbox" />
        <label for="consentCheckbox">
          I agree to the Terms & Data Consent.
        </label>
      </div>

      <button id="btnConsentNext" class="primary" disabled>
        Continue
      </button>
    </section>

    <!-- ================= CONTEXT ================= -->
    <section id="screen-context" class="screen">
      <h2>Context</h2>

      <p class="muted">Time of day</p>
      <div class="seg">
        <button data-time="morning">Morning</button>
        <button data-time="afternoon">Afternoon</button>
        <button data-time="evening">Evening</button>
        <button data-time="night">Night</button>
      </div>

      <p class="muted">
        Fatigue: <span id="fatigueVal">4</span>
      </p>
      <input id="fatigue" type="range" min="1" max="7" value="4" />

      <label class="muted">Input device</label>
      <select id="inputDevice" class="input">
        <option value="touch">Touch</option>
        <option value="mouse">Mouse</option>
        <option value="trackpad">Trackpad</option>
      </select>

      <label class="muted">Vibration / movement</label>
      <select id="vibration" class="input">
        <option value="none">None</option>
        <option value="low">Low</option>
        <option value="medium">Medium</option>
      </select>

      <label class="muted">Alcohol</label>
      <select id="alcohol" class="input">
        <option value="no">No</option>
        <option value="yes">Yes</option>
        <option value="prefer-not">Prefer not to say</option>
      </select>

      <button id="btnContextNext" class="primary">
        Start
      </button>
    </section>

    <!-- ================= TYPING GAME ================= -->
    <section id="screen-typing" class="screen">
      <h2>Typing</h2>

      <p class="timer">
        Time left: <span id="typingTime">60.0</span>s
      </p>

      <div id="wordPrompt" class="word"></div>

      <input
        id="wordInput"
        class="input"
        autocomplete="on"
        autocorrect="on"
        autocapitalize="none"
        spellcheck="true"
        inputmode="text"
        enterkeyhint="done"
      />

      <button id="btnSubmitWord" class="primary">
        Submit
      </button>

      <p class="muted">
        Score: <span id="typingScore">0</span> |
        Attempts: <span id="typingAttempts">0</span> |
        Accuracy: <span id="typingAccuracy">0%</span>
      </p>
    </section>

    <!-- ================= TAPPING GAME ================= -->
    <section id="screen-tapping" class="screen">
      <h2>Tapping</h2>

      <p class="timer">
        Time left: <span id="tapTime">60.0</span>s
      </p>

      <div id="tapArena">
        <div id="tapTarget"></div>
      </div>

      <p class="muted">
        Hits: <span id="tapHits">0</span> |
        Misses: <span id="tapMisses">0</span> |
        Accuracy: <span id="tapAccuracy">0%</span>
      </p>
    </section>

    <!-- ================= RESULTS ================= -->
    <section id="screen-results" class="screen">
      <h2>Results</h2>
      <div class="card">
        <p class="muted" style="margin:0 0 8px;">
          Your participant ID (stays the same on this device):
        </p>

        <div style="display:flex; gap:10px; align-items:center;">
          <input id="pidDisplay" class="input" readonly />
          <button id="btnCopyPid" class="secondary" style="width:auto; white-space:nowrap; margin-top:0;">
            Copy ID
          </button>
        </div>

        <p class="muted" style="margin:10px 0 0;">
          Sessions completed on this device: <strong><span id="sessionCountDisplay">0</span></strong>
        </p>
      </div>

      <p>
        Typing score:
        <strong><span id="resTyping">0</span></strong>
        (<span id="resTypingAcc">0</span>% accuracy)
      </p>

      <p>
        Tapping score:
        <strong><span id="resTap">0</span></strong>
        (<span id="resTapAcc">0</span>% accuracy)
      </p>

      <p>
        Total score:
        <strong><span id="resTotal">0</span></strong>
      </p>

      <p id="uploadStatus" class="muted"></p>

      <button id="btnGoToDataOnFail" class="primary" style="display:none; margin-top:10px;">
        Download CSVs (Upload failed)
      </button>

      <div class="actions">
        <button id="btnViewData" class="secondary">
          View Data
        </button>

        <button id="btnRestart" class="primary">
          Play Again
        </button>
      </div>
    </section>

    <!-- ================= DATA ================= -->
    <section id="screen-data" class="screen">
      <h2>Data</h2>
      <p class="muted">
        Session summary (human-readable) and CSV export.
      </p>

      <div id="dataSummary"></div>

      <button
        id="btnDownloadCSV"
        class="primary"
        style="margin-top:16px;"
      >
        Download CSV
      </button>

      <button
        id="btnDownloadEventsCSV"
        class="secondary"
        style="margin-top:10px;"
      >
        Download Events CSV
      </button>

      <button id="btnBackToResultsFromData" class="secondary" style="margin-top:10px;">
        Back
      </button>
    </section>

  </main>

  <!-- JS -->
  <script type="module" src="app.js"></script>
</body>
</html>